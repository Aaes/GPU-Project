%!TEX root = /Users/Nikolaj/Developer/GPU-Project/Report/Report.tex
%- Description of the insurance math used in the current solution \\

The algorithm in this project is used to determine the sum of money (called reserve) the insurance company needs to possess to be able to pay the insurance holder's spouse in the case of his or her death. The payment to the spouse will be in the form of a life annuity which is disbursed from the time of death of the insurance holder, unless the death occurs before the retirement age, in which case the money will be disbursed after a grace period determined by the insurance company at the time the insurance was taken out. 
\\
\\ We assume that the spouse of the insurance holder is of the opposite gender. If the insurance holder does not have a spouse at the time of his or her death the insurance is forfeited.
\\
\\The algorithm used here is a 4th order Runge-Kutta solver with a fixed stepsize (inds√¶t reference) where we use a series of constants determined before any calculation begins:

\begin{table}
\begin{center}
\begin{tabular}[t]{|c|c|}
	\hline
\textbf{Name}&\textbf{Meaning}\\\hline
$\tau$&The time of death of the insurance holder\\\hline
$r$&The pension age\\\hline
$g$&The grace period\\\hline
$x$&The age of the insurance holder at calculation time ($t$ = 0)\\\hline
$t$&The time of calculation\\\hline
$h$&The Stepsize of the Runge-Kutta solution\\\hline
\end{tabular}
\end{center}
\caption{Constants}
\label{table:constants}
\end{table}

$\tau$ is expressed as $x+t$. Apart from this there is also a constant $k$ which is determined by $\tau, r$ and $g$ in the following manner:

\begin{table}
\begin{center}
	\begin{tabular}[t]{|c|c|}
		\hline
		\textbf{If this statement holds}&\textbf{then $k$ equals}\\\hline
		$\tau < r$&$g$\\\hline
		$r \leq \tau < r + g$& $r + g - \tau$\\\hline
		$r + g \leq \tau$&0\\\hline
	\end{tabular}
\end{center}
\caption{How $k$ is defined}
\end{table}

The algorithm can be described as a combination of three models; an outer model that describes the life/death state of the insurance holder, a middle model that describes the married/unmarried state of the insurance holder and an inner model that describes the life/death state of the potential spouse.

NOTE: The description in the three model sections is loosely based on a description for Edlund\cite{edlu} and some passages are directly translated from this document.

\subsection{Outer model}
The outer model is expressed as the following equation:
\\ \\$\frac{d}{dt} f(t) = r(t) f(t) - \mu_t(x+t) (S_{x+t}^d (t) - f(t))$ \\

Where $S_\tau^d$is the death benefit that for a $\tau$ year old at the time $t$ is needed to cover the payment from the insurance company, $\mu_t(x+t)$ is the mortality rate for a $(x + t)$ year old and $r(t)$ is the interest rate function. In this project the interest rate function returns the constant 0.05.

The differential equation is solved from $t=120-x$ to $t=0$ with the boundary condition $f(120-x)=0$.

\subsection{Middle model}
The middle model is used to calculate $S_{x+t}^d (t)$ and is expressed with the following equation: \\ \\
$S_\tau^d(t) = \left\{ 
  \begin{array}{l l}
    	g_\tau \int	f(\eta|\tau)a_{[\eta] + g}^I(t)d\eta									& \quad \text{$\tau \le r$}\\
    	g_\tau \int	f(\eta|\tau)a_{[\eta] + r + g - \tau}^I(t)d\eta 			& \quad \text{$r \leq \tau \le r + g$}\\
			g_\tau \int	f(\eta|\tau)a_{[\eta]}^I(t)d\eta 											& \quad \text{$r +g \leq \tau$}
  \end{array} \right.$ \\ \\

Where $g_\tau$ is the probability that a $\tau$ year is married and $f(\eta|\tau)$ is the probability distribution for, that a $\tau$ year old is married to a $\eta$ year provided that the $\tau$ year old is married.
This equation can be rewritten to this form: \\

$\frac{d}{dn}f(\eta) = -g_\tau f(\eta|\tau)a_{[\eta]+k}^I(t)$ \\

here the subscript for $a$ is rewritten to $[\eta]+k$ where $k$ can fall into three different categories as shown in table \ref{table:constants}. 

This differential equation is solved from $\eta = 120$ to $\eta = 1$ with the boundary condition $f(120) = 0$.

\subsection{Inner model}
The inner model is used to calculate $a_{[\eta]+k}^I(t)$ and is expressed with the following equation: \\

$\frac{d}{ds}f(s) = r(t+s)f(s) - 1_{s \geq k} - \mu_{t+s}(\eta + s)(0 - f(s))$ \\

Where $t$, $\eta$ and $k$ are constants and $\mu_{t+s}(\eta + s)$ is the mortality rate for a $(\eta + s)$ year old.

This differential equation is solved from $s = 120 - \eta$ to $s = 0$ with the boundary condition $f(120 - \eta) = 0$

\subsection{Runge-Kutta 4th order}
The Runge-Kutta method is a method for numerically solving differential equations that builds on Eulers method \cite{nric} and the midpoint method \cite{nric}. When given a start point and a differential equation one can choose a stepsize and approximate the graph.
When given a point $(x_n,y_n)$, a differential equation $f$ and a stepsize $h$ one can use the Runge-Kutta method to approximate the next point in the following way: \\

\noindent $k1 = h f(x_n, y_n)$ \\
$k2 = h f(x_n + \frac{h}{2}, y_n + \frac{k1}{h} )$ \\
$k3 = h f(x_n + \frac{h}{2}, y_n + \frac{k2}{h} )$ \\
$k4 = h f(x_n + h, y_n + k3 )$ \\ \\
$x_{n + 1} = x_n + h$ \\
$y_{n + 1} = y_n + \frac{k1}{6} + \frac{k2}{3} + \frac{k3}{3} + \frac{k4}{6} + O(h^5)$

\subsection{Description of execution}
	To provide a better overview of how the mathematical principles are applied we go through how an execution is performed. Before the execution begins certain value are give before hand, namely $g$, $r$ and $x$. Additionally we need to decide on a stepsize before the execution can begin. \\
	
	The first step in the execution is to use the outer model with a starting point. Since the outer model is to be solved for $t=120-x$ to $t=0$ with the boundary condition $f(120-x)=0$ we can use the point $(120-x, 0)$ as our starting point. The next step is to actually solve the outer model equation to calculate the next approximate point. All the components in the outer models differential equation can be computed using normal equations except $S_{x+t}^d (t)$. This component can be calculated using the middle model and when it computed the calculation of the next approximate point is completed. The outer model equation is solved four times for each approximation of the next point corresponding to calculating $k1$, $k2$, $k3$ and $k4$ in the Runge Kutta method. This can be repeated $(120-x) \times stepsize$ times until the approximate point becomes $(0,y)$ which is the final point. \\
	
	To calculate the missing component using the middle model we need to establish the value of $k$ for the point. Additionally we are given the value $t$ from the outer model. Like the outer model we need to use the middle model with a starting point. The middle model is to be solved for $\eta = 120$ to $\eta = 1$ with the boundary condition $f(120) = 0$ which means that we can use $(120,0)$ as our starting point. As with the outer model all the components of the differential equation in the middle model can be computed using normal equations except $a_{[\eta]+k}^I(t)$. This can be calculated using the inner model which is the last model in the chain. When the inner model has computed a result the calculation of the next approximate point is completed. As in the previous model the middle model equation is calculated four times corresponding to calculating $k1$, $k2$, $k3$ and $k4$ in the Runge Kutta method. This can be repeated $119 \times stepsize$ times until the approximate point becomes $(0,y)$ which is the final point and the $y$-value of this point is returned to the outer model. \\
	
	As the last part of the execution the inner model needs to calculate the last component used by the middle model. The inner model uses the $t$, $k$ and $\eta$ values provided by the middle model. This model uses a starting point in the same way as the other models. This model is to be solved for $s = 120 - \eta$ to $s=0$ with the boundary condition $f(120 - \eta) = 0$ which means we can use the point $(120-\eta,0)$ as a starting point. Contrary to the other two models the inner model equation only contain components that can be computed using normal equations to find the next approximate point. For each approximation of a point the inner model equation is solved four times corresponding to calculating $k1$, $k2$, $k3$ and $k4$ in the Runge Kutta method. This can be repeated $(120 - \eta) \times stepsize$ times until the approximate point becomes $(0,y)$ which is the final point and the $y$-value of this point is returned to the middle model. \\ 
	
	In any execution the outer model equation will be solved \\
	$(120-x) \times stepsize \times 4$ times,\\
	the middle model equation will be solved \\
	$((120-x) \times stepsize) \times (119 \times stepsize \times 4)$ times, \\
	and the inner model equation will be solved \\
	 $((120-x) \times stepsize \times 4) \times 
	(\sum\limits_{i=120 \times stepsize}^{stepsize+1} 
	(
	(120 - \frac{\eta}{stepsize}) \times stepsize \times 4) + 
	((120 - \frac{2\eta - 1}{2 \times stepsize})\times stepsize \times 4) +
	((120 - \frac{2\eta - 1}{2 \times stepsize})\times stepsize \times 4) +
	(120 - \frac{\eta-1}{stepsize}) \times stepsize \times 4)
	)$ times.\\
	
	For a normal execution with $stepsize=4$, $g=30$, $r=80$ and $x=115$ the outer model equation will be solved 80 times, the middle model equation will be solved 152.320 times and the inner model equation is solved 145.008.640 times.
